@model FairWorks.WebUI.Models.Interview.InterviewViewModel
@{
    ViewData["Title"] = "Interview";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@section DataTableCSS{
    <link href="~/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" />
    <link href="~/assets/global/plugins/datatables/datatables.min.css" rel="stylesheet" />
    <link href="~/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <link href="~/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css" rel="stylesheet" />
}

@section pageHeader{
    <div class="note note-info">
        <p> Görüşme Bilgileri,Teklif Bilgileri,Sözleşme Bilgileri</p>
    </div>
}
<div class="row">
    <div class="col-md-12 col-sm-12">
        <div class="portlet box red">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-gift"></i>Görüşme Bilgileri
                </div>
                <div class="tools">
                    <a href="~/assets/global/plugins/codemirror/addon/hint/javascript-hint.js" class="collapse" data-original-title="" title=""> </a>
                    <a href="~/assets/assets/global/img/portlet-collapse-icon.png" data-toggle="modal" class="config" data-original-title="" title=""> </a>
                    <a href="~/assets/global/plugins/codemirror/addon/hint/javascript-hint.js" class="reload" data-original-title="" title=""> </a>
                    <a href="~/assets/global/plugins/codemirror/addon/hint/javascript-hint.js" class="remove" data-original-title="" title=""> </a>
                    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&amp;subset=all" rel="stylesheet" type="text/css">
                    <link href="~/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
                    <link href="~/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
                    <link href="~/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
                    <link href="~/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
                    <link href="~/assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
                    <link href="~/assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
                    <link href="~/assets/layouts/layout/css/layout.min.css" rel="stylesheet" type="text/css" />
                    <link href="~/assets/layouts/layout/css/themes/blue.min.css" rel="stylesheet" type="text/css" id="style_color" />
                    <link href="~/assets/layouts/layout/css/custom.min.css" rel="stylesheet" type="text/css" />
                </div>
            </div>
            <div class="portlet-body form">
                <!-- BEGIN FORM-->
                <form method="post">
                    <div class="form-body">
                        <input type="hidden" name="Id" id="interviewIdToUpdate" value="" />
                        <div class="form-group col-md-6">
                            <label class="control-label">Görüşmeyi Yapan Satış Personeli</label>
                            <input id="SalesPersonName" name="SalesPerson.Name" type="text" class="form-control" placeholder="İsim">
                            <input id="SalesPersonSurname" name="SalesPerson.Surname" type="text" class="form-control" placeholder="Soyisim">
                            <input id="SalesPersonPhone" name="SalesPerson.Phone" type="text" class="form-control" placeholder="Telefon">
                            <input id="SalesPersonEmail" name="SalesPerson.Email" type="text" class="form-control" placeholder="Mail">
                        </div>
                        <div class="form-group col-md-6">
                            <label class="control-label">Görüşülen Kişinin Bilgileri</label>
                            <input id="InterviewerName" name="Interviewer.Name" type="text" class="form-control" placeholder="İsim">
                            <input id="InterviewerSurname" name="Interviewer.Surname" type="text" class="form-control" placeholder="Soyisim">
                            <input id="InterviewerPhone" name="Interviewer.Phone" type="text" class="form-control" placeholder="Telefon">
                            <input id="InterviewerDirectPhone" name="Interviewer.DirectPhone" type="text" class="form-control" placeholder="Dahili Telefon">
                            <input id="InterviewerEmail" name="Interviewer.Email" type="text" class="form-control" placeholder="Mail">
                            <input id="InterviewerTitle" name="Interviewer.Title" type="text" class="form-control" placeholder="Ünvanı">
                            <input id="InterviewerCompanyName" name="Company.Name" type="text" class="form-control" placeholder="Firma Adı">
                        </div>
                        <div class="form-group col-md-6">
                            <label class="control-label">Görüşme Tarihi</label>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <div class='input-group date' id='InterviewDatePicker'>
                                            <input id="InterviewDateId" type='text' name="InterviewDate" class="form-control" />
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-md-6" id="SectorSelectdv">
                            <label class="control-label">Firmanın Çalıştığı Sektör</label>
                            <select class="form-control" name="Sector.Id" aria-required="true" aria-invalid="false" aria-describedby="select-error">
                                <option selected disabled>Sektör Seçiniz</option>
                                @foreach (var sector in Model.Sectors)
                                {
                                    <option value="@sector.Id">@sector.Name</option>
                                }
                            </select><span id="select-error" class="help-block help-block-error"></span>
                        </div>
                        <div class="col-md-6"></div>
                        <div class="form-group col-md-6" id="CompanyProfileSelectdv">
                            <label class="control-label">Firmanın Profili</label>
                            <select class="form-control" name="CompanyProfile.Id" aria-required="true" aria-invalid="false" aria-describedby="select-error">
                                <option selected disabled>Profil Seçiniz</option>
                                @foreach (var companyProfile in Model.CompanyProfiles)
                                {
                                    <option value="@companyProfile.Id">@companyProfile.Name</option>
                                }
                            </select><span id="select-error" class="help-block help-block-error"></span>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="portlet box blue">
                                    <div class="portlet-title">
                                        <div class="caption">
                                            <i class="glyphicon glyphicon-pushpin"></i>Firmanın İlgilendiği Fuarlar
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="sample_1_2_wrapper" class="dataTables_wrapper">
                            <div class="row"></div>
                            <div class="table-scrollable">
                                <table class="table table-striped table-bordered table-hover table-checkable order-column dataTable" id="interestedFairTable" role="grid" aria-describedby="sample_1_2_info">
                                    <thead>
                                        <tr role="row">
                                            <th class="sorting_disabled" rowspan="1" colspan="1" aria-label="
                                                    " style="width: 70px;">
                                                <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                                    <input type="checkbox" class="group-checkable" data-set="#sample_1_2 .checkboxes">
                                                    <span></span>
                                                </label>
                                            </th>
                                            <th class="sorting_asc" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-sort="ascending" aria-label=" Fair Name : activate to sort column descending" style="width: 157px;"> Fair Name </th>
                                            <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Country : activate to sort column ascending" style="width: 238px;"> Country </th>
                                            <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" City : activate to sort column ascending" style="width: 119px;"> City </th>
                                            <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Start Date : activate to sort column ascending" style="width: 120px;"> Start Date </th>
                                            <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" End Date : activate to sort column ascending" style="width: 123px;"> End Date </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var fair in Model.Fairs)
                                        {
                                            @if (Model.Fairs.IndexOf(fair) % 2 == 1)
                                            {
                                                <tr class="gradeX odd" role="row">
                                                    <td>
                                                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                                            <input type="checkbox" class="checkboxes" name="FairIds" value="@fair.Id">
                                                            <span></span>
                                                        </label>
                                                    </td>
                                                    <td class="sorting_1"> @fair.Name </td>
                                                    <td>
                                                        @fair.Country
                                                    </td>
                                                    <td>
                                                        <span class="label label-sm label-info"> @fair.City </span>
                                                    </td>
                                                    <td class="center"> @fair.StartDate </td>
                                                    <td class="center">
                                                        @fair.EndDate
                                                    </td>
                                                </tr>
                                            }
                                            else
                                            {
                                                <tr class="gradeX even" role="row">
                                                    <td>
                                                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                                            <input type="checkbox" class="checkboxes" name="FairIds" value="@fair.Id">
                                                            <span></span>
                                                        </label>
                                                    </td>
                                                    <td class="sorting_1"> @fair.Name </td>
                                                    <td>
                                                        @fair.Country
                                                    </td>
                                                    <td>
                                                        <span class="label label-sm label-info"> @fair.City </span>
                                                    </td>
                                                    <td class="center"> @fair.StartDate </td>
                                                    <td class="center">
                                                        @fair.EndDate
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="portlet box blue">
                                    <div class="portlet-title">
                                        <div class="caption">
                                            <i class="glyphicon glyphicon-pushpin"></i>Fuar Salonları
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="sample_1_2_wrapper" class="dataTables_wrapper">
                            <div class="row"></div>
                            <div class="table-scrollable">
                                <table class="table table-striped table-bordered table-hover table-checkable order-column dataTable" id="activeFairSalonTable" role="grid" aria-describedby="sample_1_2_info">
                                    <thead>
                                        <tr role="row">
                                            <th class="sorting_disabled" rowspan="1" colspan="1" aria-label="
                                                    " style="width: 70px;">
                                                <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                                    <input type="checkbox" class="group-checkable" data-set="#sample_1_2 .checkboxes">
                                                    <span></span>
                                                </label>
                                            </th>
                                            <th class="sorting_asc" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-sort="ascending" aria-label=" Fair Name : activate to sort column descending" style="width: 157px;"> Fair Name </th>
                                            <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Salon Adı : activate to sort column ascending" style="width: 238px;"> Salon Adı </th>
                                            <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Salon No : activate to sort column ascending" style="width: 238px;"> Salon No </th>
                                            <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Alan : activate to sort column ascending" style="width: 119px;"> Alan </th>
                                            <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Sektör : activate to sort column ascending" style="width: 123px;"> Sektör </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var salon in Model.Salons)
                                        {
                                            @if (Model.Salons.IndexOf(salon) % 2 == 1)
                                            {
                                                <tr class="gradeX odd" role="row">
                                                    <td>
                                                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                                            <input type="checkbox" class="checkboxes" name="SalonId" value="@salon.Id">
                                                            <span></span>
                                                        </label>
                                                    </td>
                                                    <td class="sorting_1"> @salon.Fair.Name </td>
                                                    <td>
                                                        @salon.Name
                                                    </td>
                                                    <td>
                                                        <span class="label label-sm label-info"> @salon.SalonNo </span>
                                                    </td>
                                                    <td class="center"> @salon.Area </td>
                                                    <td class="center">
                                                        @salon.Sector.Name
                                                    </td>
                                                </tr>
                                            }
                                            else
                                            {
                                                <tr class="gradeX even" role="row">
                                                    <td>
                                                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                                            <input type="checkbox" class="checkboxes" name="SalonId" value="@salon.Id">
                                                            <span></span>
                                                        </label>
                                                    </td>
                                                    <td class="sorting_1"> @salon.Fair.Name </td>
                                                    <td>
                                                        @salon.Name
                                                    </td>
                                                    <td>
                                                        <span class="label label-sm label-info"> @salon.SalonNo </span>
                                                    </td>
                                                    <td class="center"> @salon.Area </td>
                                                    <td class="center">
                                                        @salon.Sector.Name
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row">
                            <br />
                        </div>
                        <div class="form-group">
                            <label class="col-md-3 control-label">Görüşme Notları</label>
                            <div class="col-md-9">
                                <textarea name="Notes" class="form-control" rows="3"></textarea>
                            </div>
                        </div>
                        <div>
                            <button formaction="/Interview/AddInterview" class="btn green">Kaydet</button>
                            <button formaction="/Interview/InterviewUpdate" id="InterviewUpdateBtn" class="btn blue">Görüşmeyi Güncelle</button>
                            
                            @*<button type="button" class="btn default">Sil</button>*@
                        </div>
                    </div>
                </form>
            </div>
            <!-- END FORM-->
        </div>
        <div class="portlet box green-soft">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fas fa-info"></i>Kayıtlı Görüşmeler
                </div>
                <div class="tools">
                    <a href="~/assets/global/plugins/codemirror/addon/hint/javascript-hint.js" class="collapse" data-original-title="" title=""> </a>
                    <a href="~/assets/assets/global/img/portlet-collapse-icon.png" data-toggle="modal" class="config" data-original-title="" title=""> </a>
                    <a href="~/assets/global/plugins/codemirror/addon/hint/javascript-hint.js" class="reload" data-original-title="" title=""> </a>
                    <a href="~/assets/global/plugins/codemirror/addon/hint/javascript-hint.js" class="remove" data-original-title="" title=""> </a>
                </div>
            </div>
            <div class="portlet-body form">
                <div id="sample_1_2_wrapper" class="dataTables_wrapper">
                    <div class="row"></div>
                    <div class="table-scrollable">
                        <table class="table table-striped table-bordered table-hover table-checkable order-column dataTable" id="recordedInterviewsTable" role="grid" aria-describedby="sample_1_2_info">
                            <thead>
                                <tr role="row">
                                    <th class="sorting_asc" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-sort="ascending" aria-label=" Şirket Adı : activate to sort column descending" style="width: 157px;"> Şirket Adı </th>
                                    <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Fuar Adları : activate to sort column ascending" style="width: 238px;"> Fuar Adları </th>
                                    <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Salon : activate to sort column ascending" style="width: 119px;"> Salon </th>
                                    <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Satış Personeli : activate to sort column ascending" style="width: 120px;"> Satış Personeli </th>
                                    <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Görüşülen Personel : activate to sort column ascending" style="width: 123px;"> Görüşülen Personel </th>
                                    <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Sektör : activate to sort column ascending" style="width: 123px;"> Sektör </th>
                                    <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Güncelle : activate to sort column ascending" style="width: 123px;"> Güncelle </th>
                                    <th class="sorting" tabindex="0" aria-controls="sample_1_2" rowspan="1" colspan="1" aria-label=" Sil : activate to sort column ascending" style="width: 123px;"> Sil </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var interview in Model.Interviews)
                                {
                                    @if (Model.Interviews.IndexOf(interview) % 2 == 1)
                                    {
                                        <tr class="gradeX odd" role="row">
                                            <td class="sorting_1"> @interview.Company.Name </td>
                                            <td>
                                                @{
                                                    List<string> fairnames = new List<string>();
                                                    @foreach (var interviewFair in interview.InterviewFairs)
                                                    {
                                                        fairnames.Add(interviewFair.Fair.Name);
                                                    }
                                                    var result = string.Join(',', fairnames.ToArray());
                                                }
                                                @result
                                            </td>
                                            <td>
                                                <span class="label label-sm label-info"> @interview.Salon.Name </span>
                                            </td>
                                            <td class="center"> @interview.SalesPerson.Name </td>
                                            <td class="center">
                                                @interview.Interviewer.Name
                                            </td>
                                            <td class="center">
                                                @interview.Sector.Name
                                            </td>
                                            <td>
                                                <a class="btn blue btn-outline sbold" name="interviewUpdateAnchor" id="@interview.Id"> Güncelle </a>
                                            </td>
                                            <td>
                                                <a class="btn btn-danger btn-sm" name="interviewDeleteAnchor" id="@interview.Id">Delete</a>
                                            </td>
                                        </tr>
                                    }
                                    else
                                    {
                                        <tr class="gradeX even" role="row">
                                            <td class="sorting_1"> @interview.Company.Name </td>
                                            <td>
                                                @{
                                                    List<string> fairnames = new List<string>();
                                                    @foreach (var interviewFair in interview.InterviewFairs)
                                                    {
                                                        fairnames.Add(interviewFair.Fair.Name);
                                                    }
                                                    var result = string.Join(',', fairnames.ToArray());
                                                }
                                                @result
                                            </td>
                                            <td>
                                                <span class="label label-sm label-info"> @interview.Salon.Name </span>
                                            </td>
                                            <td class="center"> @interview.SalesPerson.Name </td>
                                            <td class="center">
                                                @interview.Interviewer.Name
                                            </td>
                                            <td class="center">
                                                @interview.Sector.Name
                                            </td>
                                            <td>
                                                <a class="btn blue btn-outline sbold" name="interviewUpdateAnchor" id="@interview.Id"> Güncelle </a>
                                            </td>
                                            <td>
                                                <a class="btn btn-danger btn-sm" name="interviewDeleteAnchor" id="@interview.Id">Delete</a>
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section DataTableJS{
    <script src="~/assets/global/plugins/datatables/datatables.all.min.js"></script>
    <script src="~/assets/global/plugins/datatables/datatables.min.js"></script>
    <script>
        $(document).ready(function () {
            if ($('#interviewIdToUpdate').val() == undefined || $('#interviewIdToUpdate').val() == "") {
                $('#InterviewUpdateBtn').attr("disabled", true);
            }
            $('#interestedFairTable').DataTable();
            $('#activeFairSalonTable').DataTable();
            $('#recordedInterviewsTable').DataTable();
        });
    </script>
    <script src="~/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
    <script type="text/javascript">
        $(function () {
            $('#InterviewDatePicker').datetimepicker();
        });
    </script>
    <script src="../assets/pages/scripts/ui-modals.min.js" type="text/javascript"></script>
    <script>
        $("[name='interviewUpdateAnchor']").click(function () {
            $.ajax({
                url: 'http://localhost:57901/Interview/InterviewUpdate?Id=' + this.id,
                type: "GET",
                success: function (data) {
                    $('#interviewIdToUpdate').val(data.interview.id);
                    $('#InterviewUpdateBtn').attr("disabled", false);

                    $('#SalesPersonName').val(data.interview.salesPerson.name);
                    $('#SalesPersonSurname').val(data.interview.salesPerson.surname);
                    $('#SalesPersonPhone').val(data.interview.salesPerson.phone);
                    $('#SalesPersonEmail').val(data.interview.salesPerson.email);

                    $('#InterviewerName').val(data.interview.interviewer.name);
                    $('#InterviewerSurname').val(data.interview.interviewer.surname);
                    $('#InterviewerPhone').val(data.interview.interviewer.name);
                    $('#InterviewerDirectPhone').val(data.interview.interviewer.directPhone);
                    $('#InterviewerEmail').val(data.interview.interviewer.email);
                    $('#InterviewerTitle').val(data.interview.interviewer.title);
                    $('#InterviewerCompanyName').val(data.interview.company.name);

                    $('#SectorSelectdv select option').filter(function () {
                        return ($(this).val() == data.interview.sector.id);
                    }).prop('selected', true);

                    $('#CompanyProfileSelectdv select option').filter(function () {
                        return ($(this).val() == data.interview.companyProfile.id);
                    }).prop('selected', true);

                    $('#InterviewDateId').val(data.interview.interviewDate);

                    $('#interestedFairTable tr:has(td)').find('input[type="checkbox"]').each(function () {
                        var chkbox = $(this);
                        data.interview.interviewFairs.forEach(function (item) {
                            if (chkbox.val() == item.fair.id) {
                                chkbox.prop('checked', true);
                            }
                        });
                    })

                    $('#activeFairSalonTable tr:has(td)').find('input[type="checkbox"]').each(function () {
                        var chkbox = $(this);
                        debugger;
                        if (chkbox.val() == data.interview.salon.id) {
                            chkbox.prop('checked', true);
                        }
                    })
                },
            })
        });
        $("[name='interviewDeleteAnchor']").click(function () {
            $.ajax({
                url: 'http://localhost:57901/Interview/InterviewDelete?Id=' + this.id,
                type: "DELETE",
            })
        });
    </script>
}



